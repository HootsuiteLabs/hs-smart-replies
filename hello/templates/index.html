{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

<div>
  	<div class="cardholder">
  		<div class="card">
  			<div class="pic">

  			</div>

  			<div class="message">
  			Hello my baby, hello my honey, hello my ragtime gal. Champs of the hackathon.
  			</div>

  			<div class="footer">
  				<div class="site">
  				gizmodo.com
  				</div>
  				<div class="date">
  				Oct 3
  				</div>
  			</div>
  		</div>

  		<div class="card">
  		</div>

  		<div class="card">
  		</div>

  		<div class="card">
  		</div>
  	</div>

  	<div class="blackbar">
  		<div class="butt" onclick="listen()">
  		</div>
  	</div>

  	<div class="owllisten">
  	bonjour
  	</div>

  <script type="text/javascript">
  // JQuery stuff
  $(document).ready(function(){

      $(".card").click(function(){
          $(".card").stop(true, false).animate({ left: "-=375px", } );
      });

      $(".butt").click(function(){
          $(".owllisten").toggleClass("popup");
      });



  });

  // set up global vars
  var recognition, voiceMessage;

  // set up speech recognition
  if (!('webkitSpeechRecognition' in window)) {
    console.log('NO SUPPORT FOR SPEECH!');
  } else {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onstart = function() {
      console.log('started recognition');
    }
    recognition.onresult = function(event) {
      console.log('speech has been captured');
      console.log(event);
      var final_transcript = '';

      for (var i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          final_transcript += event.results[i][0].transcript;
        }
      }
      console.log(final_transcript);
      recognition.stop();
      if (final_transcript === 'content') {
        speak('OK. I will look for some content for you, master');
        $.getJSON( "articles/", function( data ) {
          console.log(data);
        });
      } else {
        speak('Sorry master. I do not understand what you are saying');
      }
    }
    recognition.onerror = function(event) {
      console.log('error during speech recognition!');
    }
    recognition.onend = function() {
      console.log('finished speech recognition');
    }
  }

  // set up speech speechSynthesis
  if (!('SpeechSynthesisUtterance' in window)) {
    console.log('NO SUPPORT FOR SPEECH SYNTH!');
  } else {
    voiceMessage = new SpeechSynthesisUtterance();
  }

  // listen and speak functions
  var listen = function () {
    if (recognition) {
      recognition.start();
    }
  }
  var speak = function (msg) {
    if (voiceMessage) {
      voiceMessage.text = msg
      window.speechSynthesis.speak(voiceMessage);
    }
  }

  speak('hello master. what can i do for you?');

  </script>
</div>
{% endblock %}
